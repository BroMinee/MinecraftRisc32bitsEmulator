#include <stdint.h>

#define SCREEN_WIDTH  64
#define SCREEN_HEIGHT 64
#define SCREEN_START_ADDRESS 0x0FFF0000



void write_pixel(uint16_t x, uint16_t y, uint16_t r, uint16_t g, uint16_t b);
void draw_char(int x, int y, char c, uint8_t r, uint8_t g, uint8_t b);
void draw_string(int x, int y, const char *str, uint8_t r, uint8_t g, uint8_t b);
void main()
{
	const char *str = "Hello\nWorld!:)";
	draw_string(0, 0, str, 0, 0xff, 0);
}
 

void write_pixel(uint16_t x, uint16_t y, uint16_t r, uint16_t g, uint16_t b) {

    if (x >= SCREEN_WIDTH || y >= SCREEN_HEIGHT) {
        return;
    }

    uint32_t color = (r << 16) + (g << 8) + b;
    uint32_t *screen = (uint32_t *)SCREEN_START_ADDRESS;
    uint32_t pixel_offset = x + y * SCREEN_HEIGHT;


    screen[pixel_offset] = color;
}

const uint8_t font_5x7[][5] = {
    {0x00, 0x00, 0x00, 0x00, 0x00}, // (espace)
    {0x04, 0x04, 0x04, 0x00, 0x04}, // !
    {0x0A, 0x0A, 0x00, 0x00, 0x00}, // "
    {0x0A, 0x1F, 0x0A, 0x1F, 0x0A}, // #
    {0x04, 0x0F, 0x14, 0x0F, 0x04}, // $
    {0x13, 0x08, 0x04, 0x02, 0x19}, // %
    {0x06, 0x09, 0x15, 0x02, 0x05}, // &
    {0x06, 0x06, 0x00, 0x00, 0x00}, // '
    {0x02, 0x04, 0x04, 0x04, 0x02}, // (
    {0x08, 0x04, 0x04, 0x04, 0x08}, // )
    {0x00, 0x0A, 0x04, 0x0A, 0x00}, // *
    {0x00, 0x04, 0x0E, 0x04, 0x00}, // +
    {0x00, 0x00, 0x00, 0x06, 0x06}, // ,
    {0x00, 0x00, 0x0E, 0x00, 0x00}, // -
    {0x00, 0x00, 0x00, 0x06, 0x06}, // .
    {0x00, 0x01, 0x02, 0x04, 0x08}, // /
    {0x0E, 0x11, 0x19, 0x15, 0x0E}, // 0
    {0x04, 0x0C, 0x04, 0x04, 0x0E}, // 1
    {0x0E, 0x11, 0x06, 0x08, 0x1F}, // 2
    {0x0E, 0x11, 0x06, 0x01, 0x0E}, // 3
    {0x02, 0x06, 0x0A, 0x1F, 0x02}, // 4
    {0x1F, 0x10, 0x1E, 0x01, 0x1E}, // 5
    {0x0E, 0x10, 0x1E, 0x11, 0x0E}, // 6
    {0x1F, 0x01, 0x02, 0x04, 0x08}, // 7
    {0x0E, 0x11, 0x0E, 0x11, 0x0E}, // 8
    {0x0E, 0x11, 0x0F, 0x01, 0x0E}, // 9
    {0x00, 0x06, 0x00, 0x00, 0x06}, // :
    {0x00, 0x06, 0x06, 0x00, 0x06}, // ;
    {0x02, 0x04, 0x08, 0x04, 0x02}, // <
    {0x00, 0x0E, 0x00, 0x0E, 0x00}, // =
    {0x08, 0x04, 0x02, 0x04, 0x08}, // >
    {0x0E, 0x11, 0x02, 0x00, 0x04}, // ?
    {0x0E, 0x15, 0x17, 0x10, 0x0E}, // @
    {0x0E, 0x11, 0x1F, 0x11, 0x11}, // A
    {0x1E, 0x11, 0x1E, 0x11, 0x1E}, // B
    {0x0E, 0x11, 0x10, 0x11, 0x0E}, // C
    {0x1E, 0x11, 0x11, 0x11, 0x1E}, // D
    {0x1F, 0x10, 0x1E, 0x10, 0x1F}, // E
    {0x1F, 0x10, 0x1E, 0x10, 0x10}, // F
    {0x0E, 0x10, 0x13, 0x11, 0x0E}, // G
    {0x11, 0x11, 0x1F, 0x11, 0x11}, // H
    {0x0E, 0x04, 0x04, 0x04, 0x0E}, // I
    {0x01, 0x01, 0x01, 0x11, 0x0E}, // J
    {0x11, 0x12, 0x1C, 0x12, 0x11}, // K
    {0x10, 0x10, 0x10, 0x10, 0x1F}, // L
    {0x11, 0x1B, 0x15, 0x11, 0x11}, // M
    {0x11, 0x19, 0x15, 0x13, 0x11}, // N
    {0x0E, 0x11, 0x11, 0x11, 0x0E}, // O
    {0x1E, 0x11, 0x1E, 0x10, 0x10}, // P
    {0x0E, 0x11, 0x15, 0x12, 0x0D}, // Q
    {0x1E, 0x11, 0x1E, 0x12, 0x11}, // R
    {0x0E, 0x10, 0x0E, 0x01, 0x0E}, // S
    {0x1F, 0x04, 0x04, 0x04, 0x04}, // T
    {0x11, 0x11, 0x11, 0x11, 0x0E}, // U
    {0x11, 0x11, 0x11, 0x0A, 0x04}, // V
    {0x11, 0x11, 0x15, 0x1B, 0x11}, // W
    {0x11, 0x0A, 0x04, 0x0A, 0x11}, // X
    {0x11, 0x11, 0x0A, 0x04, 0x04}, // Y
    {0x1F, 0x02, 0x04, 0x08, 0x1F}, // Z
    {0x0E, 0x08, 0x08, 0x08, 0x0E}, // [
    {0x00, 0x08, 0x04, 0x02, 0x01}, // \ (backslash)
    {0x0E, 0x02, 0x02, 0x02, 0x0E}, // ]
    {0x04, 0x0A, 0x00, 0x00, 0x00}, // ^
    {0x00, 0x00, 0x00, 0x00, 0x1F}, // _
    {0x06, 0x02, 0x00, 0x00, 0x00}, // `
    {0x04, 0x0A, 0x11, 0x1F, 0x11}, // a
    {0x10, 0x1E, 0x11, 0x11, 0x1E}, // b
    {0x00, 0x0E, 0x10, 0x10, 0x0E}, // c
    {0x01, 0x0F, 0x11, 0x11, 0x0F}, // d
    {0x0E, 0x11, 0x1E, 0x10, 0x0E}, // e
    {0x06, 0x08, 0x1E, 0x08, 0x08}, // f
    {0x0E, 0x11, 0x0F, 0x01, 0x0E}, // g
    {0x10, 0x1E, 0x11, 0x11, 0x11}, // h
    {0x04, 0x00, 0x0C, 0x04, 0x0E}, // i
    {0x02, 0x00, 0x02, 0x12, 0x0C}, // j
    {0x10, 0x12, 0x1C, 0x12, 0x11}, // k
    {0x0C, 0x04, 0x04, 0x04, 0x0E}, // l
    {0x00, 0x1E, 0x15, 0x15, 0x15}, // m
    {0x00, 0x1E, 0x11, 0x11, 0x11}, // n
    {0x00, 0x0E, 0x11, 0x11, 0x0E}, // o
    {0x00, 0x1E, 0x11, 0x1E, 0x10}, // p
    {0x00, 0x0F, 0x11, 0x0F, 0x01}, // q
    {0x00, 0x1E, 0x11, 0x10, 0x10}, // r
    {0x0E, 0x10, 0x0E, 0x01, 0x0E}, // s
    {0x08, 0x1E, 0x08, 0x08, 0x06}, // t
    {0x00, 0x11, 0x11, 0x11, 0x0F}, // u
    {0x00, 0x11, 0x11, 0x0A, 0x04}, // v
    {0x00, 0x11, 0x15, 0x15, 0x0A}, // w
    {0x00, 0x11, 0x0A, 0x04, 0x0A}, // x
    {0x00, 0x11, 0x11, 0x0F, 0x01}, // y
    {0x00, 0x1F, 0x02, 0x04, 0x1F}, // z
    {0x06, 0x08, 0x10, 0x08, 0x06}, // {
    {0x04, 0x04, 0x04, 0x04, 0x04}, // |
    {0x0C, 0x02, 0x01, 0x02, 0x0C}, // }
    {0x08, 0x15, 0x02, 0x00, 0x00}, // ~
};

void draw_char(int x, int y, char c, uint8_t r, uint8_t g, uint8_t b) {
    if (c < ' ' || c > '~') {
	return;
    }

    c -= ' ';

    for (int row = 0; row < 5; row++) {
        uint8_t line = font_5x7[(int)c][row];
        for (int col = 0; col < 6; col++) {
            if (line & (1 << (5 - col))) {
                write_pixel(x + col, y + row, r, g, b);
            }
        }
    }
}

void draw_string(int x, int y, const char *str, uint8_t r, uint8_t g, uint8_t b) {
    while (*str) {
        if (*str == '\n' || x + 6 > 64) {
            x = 0;
            y += 7;
            if (y + 7 > 64) break;
	    if(*str == '\n') {
	        str += 1;
		continue;
	    }
        }
        draw_char(x, y, *str, r, g, b);
        x += 7;
        str++;
    }
}
